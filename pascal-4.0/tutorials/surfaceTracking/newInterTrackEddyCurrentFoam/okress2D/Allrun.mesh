#!/bin/bash

# Remove old polyMesh
rm -rf '0/polyMesh'
rm -rf 'constant/polyMesh'

# Get blockMeshDict.py script from storage folder
mkdir 'constant/polyMesh'
cp -r 'constant/polyMesh.org/blockMeshDict.py' 'constant/polyMesh/'

# Create blockMeshDict
./constant/polyMesh/blockMeshDict.py

# Run blockMesh
blockMesh

# Mirror mesh in z-direction
directions="z"
for d in $directions; do

    cp "system/mirrorMeshDict.$d" \
        'system/mirrorMeshDict'

    mirrorMesh

done

# Move new polyMesh files to storage folder
meshFolder='0/polyMesh'
[[ ! -e "$meshFolder" ]] && meshFolder='constant/polyMesh'
mv "$meshFolder/boundary" \
   "$meshFolder/faces" \
   "$meshFolder/neighbour" \
   "$meshFolder/owner" \
   "$meshFolder/points" \
   'constant/polyMesh.org/'

# Remove polyMesh
rm -rf "$meshFolder"
